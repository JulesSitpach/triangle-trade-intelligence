"use strict";(()=>{var e={};e.id=8579,e.ids=[8579],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6535:(e,t,n)=>{n.r(t),n.d(t,{config:()=>c,default:()=>u,routeModule:()=>g});var a={};n.r(a),n.d(a,{default:()=>handler});var r=n(1802),i=n(7153),o=n(6249),s=n(6553);let l=(0,s.Ng)();async function generateMarcusInsights(e,t=!1){let{businessType:n,importVolume:a,supplierCountry:r,psychAssessment:i}=e;if(console.log("\uD83E\uDDE0 Marcus: Checking personalization",{includePersonalized:t,hasPsychAssessment:!!i,psychKeys:i?Object.keys(i):"none"}),t&&i)return console.log("✅ Marcus: Using personalized consultation"),generatePersonalizedMarcusConsultation(e);let o=[`I understand you're feeling the pressure from these ${r} tariffs - I've been helping ${n} companies like yours for over 15 years, and what you're experiencing is exactly what I helped 23 other businesses resolve this year alone.`,`Based on your ${a} import volume, I can see you're at the perfect scale to benefit from triangle routing. The companies I work with in your situation typically save $100K-$300K annually, and honestly, the setup is much simpler than most people think.`,`Here's what I recommend for your immediate next step: Let's start with a pilot program using your top 3 products through Mexico. This gives you real savings data within 60 days while we build out the full routing strategy. I've done this exact approach with dozens of ${n} importers.`];return o}async function generatePersonalizedMarcusConsultation(e){let{businessType:t,importVolume:n,supplierCountry:a,psychAssessment:r}=e,{tariffPain:i,changeBarrier:o,complexityConcern:s,urgencyMode:l}=r;if(process.env.ANTHROPIC_API_KEY)try{return await generateClaudeMarcusResponse(e)}catch(e){console.warn("Claude API unavailable, using intelligent fallback:",e.message)}let u=function(e){let{businessType:t,importVolume:n,supplierCountry:a,psychAssessment:r}=e,{tariffPain:i,changeBarrier:o,complexityConcern:s,urgencyMode:l}=r,u=n.includes("$25M")?"400K":n.includes("$5M")?"250K":"150K",c="";return"emergency"===l&&"critical"===i?c+=`Based on where you're at - with tariffs threatening your margins and needing immediate action - I've seen this exact crisis before. Last month I helped a ${t} company in similar emergency mode save $${u} within 90 days using Mexico routing. `:"planned"===l&&"low"===s?c+=`Here's what makes sense for your situation - you're approaching this strategically, which gives us the luxury of doing it right. With your ${n} volume through ${a}, we can build a comprehensive triangle routing strategy that saves you $${u} annually. `:c+="Looking at your specific combination of concerns, I understand you're dealing with real pressure but want to move carefully. That's exactly the right approach. ","complexity"===o&&"very_high"===s?c+="Since managing complexity is your biggest worry, I handle all the coordination personally. We start with one product, one route, prove it works, then expand. No overwhelming process management on your end. ":"risk"===o&&"urgent"===l?c+="Your concern about operational risk makes sense, especially with tight timelines. That's why we pilot with 15% of volume first - you get real savings data without jeopardizing core operations. ":"resources"===o&&"significant"===i?c+=`Budget constraints are real, but triangle routing pays for itself. The ${u} in annual savings funds the entire setup within 3 months. `:c+="Your main obstacle is actually an advantage - it means you're thinking this through carefully rather than rushing in. ","emergency"===l?c+="Next step: I can have preliminary savings analysis ready in 48 hours and start your Mexico connections immediately.":"very_high"===s?c+="Next step: Let's schedule a detailed walkthrough where I show you exactly how this works, step by step.":c+="Next step: Review the triangle routing analysis, then we'll identify your best pilot products for a 60-day test run.",c}(e);return[u]}async function generateClaudeMarcusResponse(e){let{psychAssessment:t}=e;throw t.tariffPain,t.changeBarrier,t.complexityConcern,t.urgencyMode,Error("Claude API not configured")}async function getRoutingIntelligence(e){try{let{data:t,error:n}=await l.from("trade_flows").select("*").eq("reporter_country","China"===e.supplierCountry?"China":"India").limit(100);n&&console.warn("Trade flows query error:",n);let{data:a}=await l.from("triangle_routing_opportunities").select("*").eq("origin_country",e.supplierCountry).limit(10);return{trade_patterns:t?.length||0,routing_opportunities:a?.length||0,confidence_score:94,data_points:(t?.length||0)+(a?.length||0)}}catch(e){return console.error("Routing intelligence error:",e),{trade_patterns:0,routing_opportunities:0,confidence_score:75,data_points:0}}}async function handler(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let{businessType:n,importVolume:a,supplierCountry:r,productCategories:i,psychAssessment:o,includePersonalizedInsights:s}=e.body;if(!n||!a||!r)return t.status(400).json({error:"Missing required parameters"});try{console.log("\uD83D\uDD25 Blaze API: Generating triangle routing intelligence for:",n);let e={businessType:n,importVolume:a,supplierCountry:r,psychAssessment:o},l=await generateMarcusInsights(e,s),u=function(e){let{importVolume:t,businessType:n,supplierCountry:a}=e,r={"Under $500K":25e4,"$500K - $1M":75e4,"$1M - $5M":3e6,"$5M - $25M":15e6,"Over $25M":5e7}[t]||3e6,i={China:.3,India:.5,Vietnam:.15,Thailand:.12}[a]||.25,o=r*i,s=o-0*r;return{current_tariff_rate:100*i,triangle_tariff_rate:0,annual_import_volume:r,current_annual_tariff_cost:o,triangle_annual_tariff_cost:0,total_potential_savings:s,monthly_savings:s/12,roi_percentage:s/r*100,payback_period_months:3}}(e),c=await getRoutingIntelligence(e),g={success:!0,timestamp:new Date().toISOString(),business_profile:{type:n,volume:a,supplier_country:r,product_categories:i||[n]},marcus_ai_insights:l,savings_calculation:u,routing_intelligence:{...c,total_potential_savings:u.total_potential_savings,recommended_routes:[{name:`${r} → Mexico → USA`,tariff_rate:0,estimated_savings:u.total_potential_savings,confidence:94,implementation_time:"4-6 months"},{name:`${r} → Canada → USA`,tariff_rate:0,estimated_savings:.85*u.total_potential_savings,confidence:89,implementation_time:"3-5 months"}]},intelligence_source:"blaze_api",confidence_score:94};console.log(`✅ Blaze API: Generated insights with $${Math.round(u.total_potential_savings/1e3)}K potential savings`),t.status(200).json(g)}catch(e){console.error("Blaze triangle routing API error:",e),t.status(500).json({error:"Internal server error",success:!1})}}let u=(0,o.l)(a,"default"),c=(0,o.l)(a,"config"),g=new r.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/blaze/triangle-routing",pathname:"/api/blaze/triangle-routing",bundlePath:"",filename:""},userland:a})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),n=t.X(0,[4222,6553],()=>__webpack_exec__(6535));module.exports=n})();