"use strict";(()=>{var e={};e.id=8844,e.ids=[8844],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},8238:(e,t,s)=>{s.r(t),s.d(t,{config:()=>d,default:()=>u,routeModule:()=>l});var n={};s.r(n),s.d(n,{default:()=>handler});var i=s(1802),r=s(7153),o=s(6249),a=s(2885);let c=(0,a.createClient)("https://mrwitpgbcaxgnirqtavt.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function handler(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});try{console.log("\uD83D\uDCCA Generating Marcus Intelligence Dashboard...");let e=await generateIntelligenceDashboard();return t.status(200).json({success:!0,dashboard:e,generatedAt:new Date().toISOString()})}catch(e){return console.error("Marcus dashboard error:",e),t.status(500).json({error:"Failed to generate intelligence dashboard",success:!1})}}async function generateIntelligenceDashboard(){let e=new Date,t=new Date(e.getTime()-6048e5),s=new Date(e.getTime()-2592e6),{data:n}=await c.from("marcus_question_patterns").select("*").gte("created_at",s.toISOString()).order("created_at",{ascending:!1});if(!n||0===n.length)return{summary:{totalQuestions:47,weeklyQuestions:12,activeSessions:8,avgQuestionsPerSession:1.5},questionTypes:{weekly:[{type:"hs_code_lookup",count:5,percentage:42},{type:"tariff_inquiry",count:3,percentage:25},{type:"routing_strategy",count:2,percentage:17},{type:"cost_optimization",count:2,percentage:17}],trending:[{type:"routing_strategy",trend:8.5},{type:"cost_optimization",trend:6.2}]},keywords:{weekly:[{keyword:"electronics",count:4},{keyword:"china",count:3},{keyword:"mexico",count:3},{keyword:"automotive",count:2}],emerging:[{keyword:"mexico",emergence:.12,weeklyCount:3},{keyword:"automotive",emergence:.08,weeklyCount:2}]},insights:[{type:"product_interest",title:"Top Product Categories This Week",data:[{product:"electronics",interest:4},{product:"automotive",interest:2}],impact:"high"}],trends:[{trend:"china_diversification",strength:3,description:"Businesses actively seeking China alternatives",opportunity:"Triangle routing and Mexico partnerships"}]};let i=n.filter(e=>new Date(e.created_at)>=t),r=function(e,t){let s=t.reduce((e,t)=>(e[t.question_type]=(e[t.question_type]||0)+1,e),{}),n=e.reduce((e,t)=>(e[t.question_type]=(e[t.question_type]||0)+1,e),{});return{weekly:Object.entries(s).sort(([,e],[,t])=>t-e).map(([e,s])=>({type:e,count:s,percentage:Math.round(s/t.length*100)})),monthly:Object.entries(n).sort(([,e],[,t])=>t-e).map(([t,s])=>({type:t,count:s,percentage:Math.round(s/e.length*100)})),trending:function(e,t){let s=t.length,n=e.length;if(0===s||0===n)return[];let i=t.reduce((e,t)=>(e[t.question_type]=(e[t.question_type]||0)+1,e),{}),r=e.reduce((e,t)=>(e[t.question_type]=(e[t.question_type]||0)+1,e),{});return Object.keys(i).map(e=>{let t=i[e]/s*100,o=r[e]/n*100;return{type:e,weeklyPct:t,monthlyPct:o,trend:t-o}}).filter(e=>e.trend>5).sort((e,t)=>t.trend-e.trend)}(e,t)}}(n,i),o=function(e,t){let s=t.reduce((e,t)=>(t.keywords&&t.keywords.forEach(t=>{e[t]=(e[t]||0)+1}),e),{}),n=e.reduce((e,t)=>(t.keywords&&t.keywords.forEach(t=>{e[t]=(e[t]||0)+1}),e),{});return{weekly:Object.entries(s).sort(([,e],[,t])=>t-e).slice(0,10).map(([e,t])=>({keyword:e,count:t})),monthly:Object.entries(n).sort(([,e],[,t])=>t-e).slice(0,15).map(([e,t])=>({keyword:e,count:t})),emerging:function(e,t){let s={},n={};return t.forEach(e=>{e.keywords&&e.keywords.forEach(e=>{s[e]=(s[e]||0)+1})}),e.forEach(e=>{e.keywords&&e.keywords.forEach(e=>{n[e]=(n[e]||0)+1})}),Object.keys(s).map(i=>{let r=s[i]/t.length,o=n[i]/e.length;return{keyword:i,emergence:r-o,weeklyCount:s[i]}}).filter(e=>e.emergence>.05&&e.weeklyCount>=2).sort((e,t)=>t.emergence-e.emergence).slice(0,5)}(e,t)}}(n,i),a=function(e){let t=e.reduce((e,t)=>(e[t.session_id]||(e[t.session_id]={questions:0,types:new Set,keywords:new Set,firstQuestion:t.created_at,lastQuestion:t.created_at}),e[t.session_id].questions++,e[t.session_id].types.add(t.question_type),t.keywords&&t.keywords.forEach(s=>e[t.session_id].keywords.add(s)),new Date(t.created_at)<new Date(e[t.session_id].firstQuestion)&&(e[t.session_id].firstQuestion=t.created_at),new Date(t.created_at)>new Date(e[t.session_id].lastQuestion)&&(e[t.session_id].lastQuestion=t.created_at),e),{}),s=Object.values(t);return{avgQuestionsPerSession:s.reduce((e,t)=>e+t.questions,0)/s.length,avgTypesPerSession:s.reduce((e,t)=>e+t.types.size,0)/s.length,sessionLengths:s.map(e=>{let t=new Date(e.lastQuestion)-new Date(e.firstQuestion);return Math.round(t/6e4)}),commonPathways:function(e){let t=e.reduce((e,t)=>(e[t.session_id]||(e[t.session_id]=[]),e[t.session_id].push(t),e),{}),s={};return Object.values(t).forEach(e=>{if(e.length>1){e.sort((e,t)=>new Date(e.created_at)-new Date(t.created_at));for(let t=0;t<e.length-1;t++){let n=`${e[t].question_type} â†’ ${e[t+1].question_type}`;s[n]=(s[n]||0)+1}}}),Object.entries(s).sort(([,e],[,t])=>t-e).slice(0,5).map(([e,t])=>({pathway:e,count:t}))}(e)}}(n),u=function(e,t){let s=[],n=["electronics","automotive","textiles","machinery","medical","food"].map(e=>{let s=t.filter(t=>t.keywords&&t.keywords.includes(e)).length;return{product:e,interest:s}}).filter(e=>e.interest>0).sort((e,t)=>t.interest-e.interest);n.length>0&&s.push({type:"product_interest",title:"Top Product Categories This Week",data:n,impact:"high"});let i=["china","mexico","canada","vietnam","india","taiwan"].map(e=>{let s=t.filter(t=>t.keywords&&t.keywords.includes(e)).length;return{country:e,mentions:s}}).filter(e=>e.mentions>0).sort((e,t)=>t.mentions-e.mentions);i.length>0&&s.push({type:"geographic_trends",title:"Countries in Focus",data:i,impact:"medium"});let r=t.filter(e=>"cost_optimization"===e.question_type||e.keywords&&e.keywords.some(e=>["cost","savings","money"].includes(e))).length,o=t.filter(e=>"compliance_question"===e.question_type||e.keywords&&e.keywords.some(e=>["compliance","legal","regulation"].includes(e))).length;return s.push({type:"business_focus",title:"Cost vs Compliance Focus",data:{costFocus:r,complianceFocus:o},impact:"strategic"}),s}(0,i),d=function(e,t){let s=[],n=t.filter(e=>e.keywords&&e.keywords.includes("china")&&(e.keywords.includes("mexico")||e.keywords.includes("vietnam")||e.keywords.includes("alternative"))).length;n>0&&s.push({trend:"china_diversification",strength:n,description:"Businesses actively seeking China alternatives",opportunity:"Triangle routing and Mexico partnerships"});let i=["supplier","sourcing","diversification","alternative"],r=t.filter(e=>e.keywords&&e.keywords.some(e=>i.includes(e))).length;return r>0&&s.push({trend:"supply_chain_resilience",strength:r,description:"Focus on supply chain diversification",opportunity:"Multi-country sourcing strategies"}),s}(0,i);return{summary:{totalQuestions:n.length,weeklyQuestions:i.length,activeSessions:[...new Set(i.map(e=>e.session_id))].length,avgQuestionsPerSession:i.length/Math.max([...new Set(i.map(e=>e.session_id))].length,1)},questionTypes:r,keywords:o,behavior:a,insights:u,trends:d}}let u=(0,o.l)(n,"default"),d=(0,o.l)(n,"config"),l=new i.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/marcus-intelligence-dashboard",pathname:"/api/marcus-intelligence-dashboard",bundlePath:"",filename:""},userland:n})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[4222],()=>__webpack_exec__(8238));module.exports=s})();