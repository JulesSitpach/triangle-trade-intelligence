"use strict";(()=>{var e={};e.id=6702,e.ids=[6702],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},631:(e,t,r)=>{r.r(t),r.d(t,{config:()=>u,default:()=>d,routeModule:()=>h});var o={};r.r(o),r.d(o,{default:()=>handler});var n=r(1802),s=r(7153),a=r(6249);(function(){var e=Error("Cannot find module './production-logger.js'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module './environment-validation.js'");throw e.code="MODULE_NOT_FOUND",e}();let i=new class{constructor(){this.metrics=new Map,this.alerts=new Map,this.startTime=Date.now(),this.errorCount=0,this.requestCount=0,this.initializePerformanceTracking()}initializePerformanceTracking(){process.on("uncaughtException",e=>{this.trackError("uncaught_exception",e),process.exit(1)}),process.on("unhandledRejection",(e,t)=>{this.trackError("unhandled_rejection",e)})}trackWebVitals(){}observePerformance(e,t){if("PerformanceObserver"in window){let r=new PerformanceObserver(e=>{e.getEntries().forEach(t)});r.observe({entryTypes:[e]})}}trackMetric(e,t,r={}){let o={name:e,value:t,timestamp:Date.now(),metadata:r};this.metrics.set(`${e}_${Date.now()}`,o),Object(function(){var e=Error("Cannot find module './production-logger.js'");throw e.code="MODULE_NOT_FOUND",e}()).info(`Metric: ${e}`,{value:t,metadata:r}),Object(function(){var e=Error("Cannot find module './environment-validation.js'");throw e.code="MODULE_NOT_FOUND",e}())()&&this.sendToMonitoringService("metric",o)}trackError(e,t,r={}){this.errorCount++;let o={type:e,message:t.message||t,stack:t.stack,timestamp:Date.now(),context:r,userAgent:"undefined"!=typeof navigator?navigator.userAgent:"Server",url:r.url||"Unknown"};Object(function(){var e=Error("Cannot find module './production-logger.js'");throw e.code="MODULE_NOT_FOUND",e}()).error(`Error tracked: ${e}`,o),Object(function(){var e=Error("Cannot find module './environment-validation.js'");throw e.code="MODULE_NOT_FOUND",e}())()&&this.sendToErrorTracking(o),this.isCriticalError(t)&&this.createAlert("critical_error",`Critical error: ${t.message}`,o)}trackAPICall(e,t,r,o,n=null){this.requestCount++;let s={method:e,endpoint:t,duration:r,statusCode:o,timestamp:Date.now(),success:!n&&o<400,error:n?n.message:null};this.trackMetric("api.request",r,s),n&&this.trackError("api_error",n,s),r>5e3&&this.createAlert("high_latency",`Slow API call: ${e} ${t}`,s),this.checkErrorRate()}trackDatabaseOperation(e,t,r,o=null,n=null){let s={table:e,operation:t,duration:r,recordCount:o,timestamp:Date.now(),success:!n};this.trackMetric("db.query",r,s),n&&this.trackError("database_error",n,s),r>1e3&&this.createAlert("slow_query",`Slow database query: ${t} on ${e}`,s)}trackBusinessEvent(e,t={}){let r={event:e,data:t,timestamp:Date.now(),session:this.getSessionId()};Object(function(){var e=Error("Cannot find module './production-logger.js'");throw e.code="MODULE_NOT_FOUND",e}()).business(e,r),Object(function(){var e=Error("Cannot find module './environment-validation.js'");throw e.code="MODULE_NOT_FOUND",e}())()&&this.sendToAnalytics(r)}createAlert(e,t,r={}){let o={type:e,message:t,data:r,timestamp:Date.now(),severity:this.getAlertSeverity(e),acknowledged:!1};this.alerts.set(`${e}_${Date.now()}`,o),Object(function(){var e=Error("Cannot find module './production-logger.js'");throw e.code="MODULE_NOT_FOUND",e}()).warn(`Alert created: ${e}`,o),Object(function(){var e=Error("Cannot find module './environment-validation.js'");throw e.code="MODULE_NOT_FOUND",e}())()&&this.sendAlert(o)}getHealthMetrics(){let e=Date.now()-this.startTime,t=process.memoryUsage();return{uptime:Math.floor(e/1e3),requests:{total:this.requestCount,errors:this.errorCount,errorRate:this.requestCount>0?this.errorCount/this.requestCount*100:0},memory:{heapUsed:Math.round(t.heapUsed/1024/1024),heapTotal:Math.round(t.heapTotal/1024/1024),external:Math.round(t.external/1024/1024)},activeAlerts:Array.from(this.alerts.values()).filter(e=>!e.acknowledged).length,metricsCollected:this.metrics.size}}checkErrorRate(){if(this.requestCount>100){let e=this.errorCount/this.requestCount*100;e>5&&this.createAlert("high_error_rate",`Error rate is ${e.toFixed(2)}%`,{errorRate:e,totalRequests:this.requestCount,totalErrors:this.errorCount})}}isCriticalError(e){let t=e.message||e.toString();return[/database.*connection/i,/payment.*failed/i,/authentication.*failed/i,/security.*violation/i,/server.*error/i].some(e=>e.test(t))}getAlertSeverity(e){return({critical_error:"critical",high_error_rate:"high",high_latency:"medium",slow_query:"medium",security_violation:"critical",payment_failure:"critical"})[e]||"low"}getSessionId(){return`server_${Date.now()}`}async sendToMonitoringService(e,t){try{process.env.MONITORING_ENDPOINT&&await fetch(process.env.MONITORING_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.MONITORING_API_KEY}`},body:JSON.stringify({type:e,data:t,source:"triangle-intelligence"})})}catch(r){Object(function(){var e=Error("Cannot find module './production-logger.js'");throw e.code="MODULE_NOT_FOUND",e}()).error("Failed to send monitoring data",{error:r.message,type:e,data:t})}}async sendToErrorTracking(e){try{process.env.SENTRY_DSN&&Object(function(){var e=Error("Cannot find module './production-logger.js'");throw e.code="MODULE_NOT_FOUND",e}()).debug("Would send to Sentry",{error:e})}catch(t){Object(function(){var e=Error("Cannot find module './production-logger.js'");throw e.code="MODULE_NOT_FOUND",e}()).error("Failed to send error tracking data",{error:t.message,errorData:e})}}async sendToAnalytics(e){try{process.env.ANALYTICS_ENDPOINT&&await fetch(process.env.ANALYTICS_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.ANALYTICS_API_KEY}`},body:JSON.stringify(e)})}catch(t){Object(function(){var e=Error("Cannot find module './production-logger.js'");throw e.code="MODULE_NOT_FOUND",e}()).error("Failed to send analytics data",{error:t.message,event:e})}}async sendAlert(e){try{process.env.ALERT_WEBHOOK_URL&&await fetch(process.env.ALERT_WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:`ðŸš¨ Triangle Intelligence Alert: ${e.message}`,severity:e.severity,timestamp:new Date(e.timestamp).toISOString(),data:e.data})})}catch(t){Object(function(){var e=Error("Cannot find module './production-logger.js'");throw e.code="MODULE_NOT_FOUND",e}()).error("Failed to send alert",{error:t.message,alert:e})}}},trackAPICall=(e,t,r,o,n)=>i.trackAPICall(e,t,r,o,n),getHealthMetrics=()=>i.getHealthMetrics();var c=r(9475),l=r(6553);async function handler(e,t){let r=Date.now();try{if(Object(function(){var e=Error("Cannot find module '../../lib/security.js'");throw e.code="MODULE_NOT_FOUND",e}())(t),"GET"!==e.method){let o=Date.now()-r;return trackAPICall(e.method,"/api/status",o,405),t.status(405).json({error:"Method not allowed",message:"Only GET requests are supported"})}let o="true"===e.query.simple||"true"===e.query.health;if(o){(0,c.PN)("Simple health check initiated");let o={status:"healthy",timestamp:new Date().toISOString(),version:process.env.npm_package_version||"1.0.0",uptime:process.uptime(),environment:"production"},n="disconnected";try{let e=await (0,l.a5)();n=e?"connected":"disconnected",e||(o.status="unhealthy",o.issues=["database_disconnected"])}catch(e){o.status="unhealthy",o.issues=["database_error"],(0,c.H)("Database health check failed",{error:e.message})}let s=process.memoryUsage();o.database=n,o.memory_mb=Math.round(s.rss/1024/1024),o.response_time_ms=Date.now()-r;let a=Date.now()-r;return trackAPICall(e.method,"/api/status?simple=true",a,200),t.status(200).json(o)}let n=getHealthMetrics(),s="unknown";try{let e=await (0,l.a5)();s=e?"connected":"disconnected"}catch(e){s="error",console.error("Database status check failed:",e.message)}let a={comtrade:{configured:!!process.env.COMTRADE_API_KEY,status:process.env.COMTRADE_API_KEY?"ready":"not_configured"},shippo:{configured:!!process.env.SHIPPO_API_KEY,status:process.env.SHIPPO_API_KEY?"ready":"not_configured"},anthropic:{configured:!!process.env.ANTHROPIC_API_KEY,status:process.env.ANTHROPIC_API_KEY?"ready":"not_configured"},stripe:{configured:!!process.env.STRIPE_SECRET_KEY,status:process.env.STRIPE_SECRET_KEY?"ready":"not_configured"}},i={status:"operational",timestamp:new Date().toISOString(),environment:"production",version:process.env.npm_package_version||"1.0.0",uptime:n.uptime,system:{database:s,memory:n.memory,requests:n.requests,alerts:n.activeAlerts},apis:a,features:{monitoring:"enabled",security:"enabled",caching:"enabled",logging:"enabled"}},d="error"===s||n.requests.errorRate>10||!process.env.ANTHROPIC_API_KEY||!process.env.COMTRADE_API_KEY;d&&(i.status="degraded");let u=Date.now()-r;trackAPICall("GET","/api/status",u,200),t.status(200).json(i)}catch(n){let o=Date.now()-r;(0,c.H)("API Status endpoint error",{error:n.message,stack:n.stack,responseTime:`${o}ms`,ip:Object(function(){var e=Error("Cannot find module '../../lib/security.js'");throw e.code="MODULE_NOT_FOUND",e}()).getClientIP(e)}),trackAPICall("GET","/api/status",o,500,n),t.status(500).json({status:"error",timestamp:new Date().toISOString(),message:"Unable to retrieve system status"})}}!function(){var e=Error("Cannot find module '../../lib/security.js'");throw e.code="MODULE_NOT_FOUND",e}();let d=(0,a.l)(o,"default"),u=(0,a.l)(o,"config"),h=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/status",pathname:"/api/status",bundlePath:"",filename:""},userland:o})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,6553,9475],()=>__webpack_exec__(631));module.exports=r})();