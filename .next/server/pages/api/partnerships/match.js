"use strict";(()=>{var e={};e.id=4965,e.ids=[4965],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6177:(e,t,a)=>{a.r(t),a.d(t,{config:()=>u,default:()=>c,routeModule:()=>m});var i={};a.r(i),a.d(i,{default:()=>handler});var r=a(1802),n=a(7153),o=a(6249),l=a(2885);let s=(0,l.createClient)("https://mrwitpgbcaxgnirqtavt.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function handler(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{importerProfile:a,partnerType:i}=e.body,r={industry:.25,volume:.2,geography:.2,certifications:.15,timeline:.1,services:.1},n=s.from("partnership_profiles").select("*").eq("country","MX").eq("status","active");i&&(n=n.eq("partner_type",i));let{data:o,error:l}=await n;if(l)return console.error("Database error:",l),t.status(200).json({matches:getMockMatches(a),factors:r});let c=o.map(e=>{let t=0;e.industries?.includes(a.industry)&&(t+=100*r.industry);let i=parseVolume(a.volume),n=parseVolume(e.monthly_capacity);n>=i&&(t+=100*r.volume),isGeographicallyOptimal(a.location,e.location)&&(t+=100*r.geography);let o=a.required_certifications||[],l=e.certifications||[],s=o.filter(e=>l.includes(e)).length;t+=s/Math.max(o.length,1)*r.certifications*100,isTimelineCompatible(a.timeline,e.availability)&&(t+=100*r.timeline);let c=a.required_services||[],u=e.services||[],m=c.filter(e=>u.includes(e)).length;return t+=m/Math.max(c.length,1)*r.services*100,{...e,matchScore:Math.round(t),matchDetails:{industryMatch:e.industries?.includes(a.industry),volumeCompatible:n>=i,geographicallyOptimal:isGeographicallyOptimal(a.location,e.location),certificationAlignment:s/Math.max(o.length,1),timelineMatch:isTimelineCompatible(a.timeline,e.availability)},potentialValue:function(e,t){let a=parseVolume(e.volume),i=.25*a,r=.05*a;return{importerSavings:`$${(i/1e6).toFixed(1)}M`,partnerRevenue:`$${(r/1e6).toFixed(1)}M`,totalValue:`$${((i+r)/1e6).toFixed(1)}M`}}(a,0)}});c.sort((e,t)=>t.matchScore-e.matchScore),await s.from("partnership_match_logs").insert({importer_profile:a,matches_found:c.length,top_match_score:c[0]?.matchScore,timestamp:new Date().toISOString()}),t.status(200).json({matches:c.slice(0,10),factors:r,totalMatches:c.length})}catch(a){console.error("Partnership matching error:",a),t.status(500).json({error:"Failed to generate matches",matches:getMockMatches(e.body.importerProfile)})}}function parseVolume(e){if(!e)return 0;let t=e.match(/\$([\d.]+)([MK])?/i);if(!t)return 0;let a=parseFloat(t[1]);return("M"===t[2]||"m"===t[2])&&(a*=1e6),("K"===t[2]||"k"===t[2])&&(a*=1e3),a}function isGeographicallyOptimal(e,t){return e?.includes("US")||e?.includes("Canada")?["Tijuana","Juarez","Nuevo Laredo","Matamoros","Mexicali"].some(e=>t?.includes(e)):["Manzanillo","Lazaro Cardenas","Veracruz","Altamira"].some(e=>t?.includes(e))}function isTimelineCompatible(e,t){if(!e||!t)return!0;let a=new Date(e),i=new Date(t);return i<=a}function getMockMatches(e){return[{id:"mock-1",company_name:"Maquiladora Excellence Tijuana",location:"Tijuana, Baja California",partner_type:"processor",services:["Assembly","Repackaging","Labeling"],certifications:["IMMEX","ISO 9001","C-TPAT"],monthly_capacity:"$10M",matchScore:92,matchDetails:{industryMatch:!0,volumeCompatible:!0,geographicallyOptimal:!0,certificationAlignment:.8,timelineMatch:!0},potentialValue:{importerSavings:"$1.5M",partnerRevenue:"$0.3M",totalValue:"$1.8M"}},{id:"mock-2",company_name:"Logistics Hub Monterrey",location:"Monterrey, Nuevo Leon",partner_type:"logistics",services:["Warehousing","Distribution","Customs"],certifications:["AEO","ISO 28000"],monthly_capacity:"$25M",matchScore:85,matchDetails:{industryMatch:!0,volumeCompatible:!0,geographicallyOptimal:!1,certificationAlignment:.6,timelineMatch:!0},potentialValue:{importerSavings:"$1.2M",partnerRevenue:"$0.25M",totalValue:"$1.45M"}}]}let c=(0,o.l)(i,"default"),u=(0,o.l)(i,"config"),m=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/partnerships/match",pathname:"/api/partnerships/match",bundlePath:"",filename:""},userland:i})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222],()=>__webpack_exec__(6177));module.exports=a})();