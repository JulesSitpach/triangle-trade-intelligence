"use strict";(()=>{var e={};e.id=2316,e.ids=[2316],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2833:(e,t,r)=>{r.r(t),r.d(t,{config:()=>l,default:()=>c,routeModule:()=>u});var a={};r.r(a),r.d(a,{default:()=>handler});var s=r(1802),n=r(7153),o=r(6249),i=r(6553);let d=(0,i.Ng)();async function handler(e,t){if("POST"===e.method)try{let{userId:r,sessionData:a,performanceMetrics:s,engagementData:n,alertInteractions:o}=e.body,i={user_id:r,session_timestamp:new Date().toISOString(),stages_completed:a.completedStages,session_duration:a.duration,last_stage_visited:a.lastStage,created_at:new Date().toISOString()},{error:c}=await d.from("user_sessions").insert([i]);if(c&&console.error("Session tracking error:",c),s){let e={user_id:r,actual_savings:s.actualSavings,projected_savings:s.projectedSavings,realization_rate:s.realizationRate,performance_trend:s.trend,milestone_reached:s.milestone,created_at:new Date().toISOString()},{error:t}=await d.from("user_performance").insert([e]);t&&console.error("Performance tracking error:",t)}if(n){let e={user_id:r,daily_active:n.dailyActive,alert_responses:n.alertResponses,network_connections:n.networkConnections,achievement_unlocked:n.newAchievement,engagement_score:n.score,created_at:new Date().toISOString()},{error:t}=await d.from("user_engagement").insert([e]);t&&console.error("Engagement tracking error:",t)}return t.status(200).json({success:!0,message:"Retention data tracked successfully"})}catch(e){return console.error("Retention tracking failed:",e),t.status(500).json({error:"Failed to track retention data",details:e.message})}else if("GET"===e.method)try{let{userId:r}=e.query;if(!r)return t.status(400).json({error:"User ID required"});let{data:a}=await d.from("user_sessions").select("*").eq("user_id",r).order("created_at",{ascending:!1}).limit(10),{data:s}=await d.from("user_performance").select("*").eq("user_id",r).order("created_at",{ascending:!1}).limit(5),{data:n}=await d.from("user_engagement").select("*").eq("user_id",r).order("created_at",{ascending:!1}).limit(5);return t.status(200).json({success:!0,retentionData:{sessions:a,performance:s,engagement:n,totalSessions:a?.length||0,avgSavings:s?.[0]?.actual_savings||0,engagementScore:n?.[0]?.engagement_score||75}})}catch(e){return console.error("Failed to get retention data:",e),t.status(500).json({error:"Failed to retrieve retention data",details:e.message})}else t.status(405).json({error:"Method not allowed"})}let c=(0,o.l)(a,"default"),l=(0,o.l)(a,"config"),u=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/retention-tracking",pathname:"/api/retention-tracking",bundlePath:"",filename:""},userland:a})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,6553],()=>__webpack_exec__(2833));module.exports=r})();