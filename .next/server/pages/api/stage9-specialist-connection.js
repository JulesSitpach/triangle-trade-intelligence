"use strict";(()=>{var e={};e.id=9633,e.ids=[9633],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7031:(e,t,i)=>{i.r(t),i.d(t,{config:()=>c,default:()=>o,routeModule:()=>p});var n={};i.r(n),i.d(n,{default:()=>handler});var l=i(1802),a=i(7153),s=i(6249),r=i(8602);async function handler(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{var i;let n;let{userData:l,journeyResults:a,hindsightAnalysis:s,requestType:o="full_intelligence",specialistId:c=null}=e.body;if(!l||!a)return t.status(400).json({error:"Missing user data or journey results"});console.log("\uD83D\uDD2E STAGE 9 SPECIALIST CONNECTION: Processing request"),console.log(`ðŸŽ¯ Request Type: ${o}`),console.log("\uD83D\uDCCA Journey Results:",{totalSavings:a.totalFinancialBenefit,businessType:l.businessType});let p=await Object(function(){var e=Error("Cannot find module '../../lib/predictive-alerts-network-intelligence.js'");throw e.code="MODULE_NOT_FOUND",e}())(l,a,s||{});if(!p.success)return t.status(500).json({error:"Failed to generate predictive intelligence",details:p.error});let u=r.Z.qualifyLead(l,a);if(u.networkIntelligenceScore=(i=p.predictiveIntelligence,n=0,i.marketIntelligence&&(n+=25,i.marketIntelligence.tradRelationshipStatus?.momentum==="POSITIVE"&&(n+=10)),i.predictiveAlerts?.length>0&&(n+=20+Math.min(15,3*i.predictiveAlerts.length)),i.networkIntelligence&&(n+=.3*i.networkIntelligence.networkStrength),i.liveOpportunities?.length>0&&(n+=15),i.networkIntelligence?.familyNetworkAdvantage&&(n+=10),Math.min(100,Math.round(n))),u.liveOpportunityValue=p.predictiveIntelligence.specialistMatching?.liveOpportunityValue||a.totalFinancialBenefit,console.log(`ðŸ”® PREDICTIVE INTELLIGENCE: Generated with ${p.predictiveIntelligence.predictiveAlerts?.length} alerts`),console.log(`ðŸ’° LIVE OPPORTUNITY VALUE: $${u.liveOpportunityValue.toLocaleString()}`),console.log(`ðŸŒ NETWORK STRENGTH: ${p.predictiveIntelligence.networkIntelligence?.networkStrength}%`),"full_intelligence"===o)return t.status(200).json({success:!0,message:"Stage 9 intelligence generated successfully",predictiveIntelligence:p.predictiveIntelligence,enhancedQualification:{...u,alertsBonus:{networkIntelligenceScore:u.networkIntelligenceScore,liveOpportunityValue:u.liveOpportunityValue,familyNetworkMultiplier:1.25,institutionalLearningComplete:!0}},liveNetworkStatus:p.liveNetworkStatus,specialistMarketplace:{availableSpecialists:p.predictiveIntelligence.networkIntelligence?.optimalMatches||[],immediateConnections:p.predictiveIntelligence.specialistMatching?.immediateActions||[],familyNetworkBonus:p.predictiveIntelligence.specialistMatching?.familyNetworkBonus||{},totalFeePool:1.25*u.specialistFeeEstimate,platformRevenue:Math.round(.1875*u.specialistFeeEstimate)},institutionalContribution:{intelligenceQuality:10,patternsContributed:"Your journey adds to institutional learning for future users",networkStrength:p.predictiveIntelligence.networkIntelligence?.networkStrength||85,communityImpact:"Helps optimize Canada-Mexico trade for similar businesses"}});if("specialist_match"===o){let e=p.predictiveIntelligence.networkIntelligence?.optimalMatches?.slice(0,3)||[];return t.status(200).json({success:!0,message:"Specialist matching completed",specialists:e,matchingCriteria:{businessType:l.businessType,complexity:u.complexityLevel,urgency:u.urgencyScore,networkScore:u.networkIntelligenceScore},recommendations:{primaryMatch:e[0]||null,alternativeMatches:e.slice(1)||[],recommendedAction:u.leadScore>=80?"IMMEDIATE_CONNECTION":"SCHEDULED_CONSULTATION"}})}{if("connect_specialist"!==o||!c)return t.status(400).json({error:"Invalid request type",validTypes:["full_intelligence","specialist_match","connect_specialist"]});let e=p.predictiveIntelligence.networkIntelligence?.optimalMatches?.find(e=>e.id===c);if(!e)return t.status(404).json({error:"Specialist not found"});let i=await initiateSpecialistConnection(l,a,e,u);return t.status(200).json({success:!0,message:"Specialist connection initiated",connection:i,nextSteps:["Specialist will receive your connection request within 1 hour","Discovery call will be scheduled within 24-48 hours","Implementation planning begins after discovery call","Family network coordination activated for cultural bridge support"]})}}catch(e){console.error("âŒ Stage 9 Specialist Connection API Error:",e),t.status(500).json({error:"Stage 9 specialist connection failed",details:e.message})}}async function initiateSpecialistConnection(e,t,i,n){let l={specialistId:i.id,specialistName:i.name,clientCompany:e.companyName,connectionTimestamp:new Date().toISOString(),projectOverview:{businessType:e.businessType,importVolume:e.importVolume,supplierCountry:e.primarySupplierCountry,potentialSavings:t.totalFinancialBenefit,estimatedTimeline:i.estimatedTimeline,complexity:n.complexityLevel},specialistDetails:{specialization:i.specialization,experience:i.experience,matchScore:i.matchScore,estimatedFee:i.estimatedFee,availability:i.availability},nextSteps:{discoveryCall:"Schedule within 24-48 hours",needsAssessment:"Complete project requirements analysis",proposal:"Detailed implementation proposal with timeline",familyNetworkIntro:"Introduction to Canadian-Mexican cultural bridge support"},status:"CONNECTION_INITIATED",priority:n.leadScore>=80?"HIGH":"MEDIUM",revenueProjection:{specialistFee:i.estimatedFee,platformCommission:Math.round(.15*i.estimatedFee),projectValue:t.totalFinancialBenefit}};return console.log("\uD83E\uDD1D SPECIALIST CONNECTION INITIATED:",l),l}(0,i(2885).createClient)("https://mrwitpgbcaxgnirqtavt.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1yd2l0cGdiY2F4Z25pcnF0YXZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4MjUxMzQsImV4cCI6MjA2NTQwMTEzNH0.5g-eaUIwy4VQD2YfNC2sFNoZYF1HdUzVTNJZvtuVSI8"),function(){var e=Error("Cannot find module '../../lib/predictive-alerts-network-intelligence.js'");throw e.code="MODULE_NOT_FOUND",e}();let o=(0,s.l)(n,"default"),c=(0,s.l)(n,"config"),p=new l.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/stage9-specialist-connection",pathname:"/api/stage9-specialist-connection",bundlePath:"",filename:""},userland:n})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),i=t.X(0,[4222,8602],()=>__webpack_exec__(7031));module.exports=i})();