"use strict";(()=>{var e={};e.id=3760,e.ids=[3760],e.modules={4675:e=>{e.exports=require("@anthropic-ai/sdk")},2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},8146:(e,t,a)=>{a.r(t),a.d(t,{config:()=>m,default:()=>d,routeModule:()=>p});var i={};a.r(i),a.d(i,{default:()=>handler});var s=a(1802),n=a(7153),r=a(6249),o=a(2885),l=a(5246),c=a(8602);!function(){var e=Error("Cannot find module '../../lib/predictive-alerts-network-intelligence.js'");throw e.code="MODULE_NOT_FOUND",e}();let u=(0,o.createClient)("https://mrwitpgbcaxgnirqtavt.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1yd2l0cGdiY2F4Z25pcnF0YXZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4MjUxMzQsImV4cCI6MjA2NTQwMTEzNH0.5g-eaUIwy4VQD2YfNC2sFNoZYF1HdUzVTNJZvtuVSI8");let SpecialistLeadEngine=class SpecialistLeadEngine{constructor(){this.qualificationThresholds={PLATINUM:{minSavings:1e7,minScore:90},GOLD:{minSavings:5e6,minScore:80},SILVER:{minSavings:2e6,minScore:70},BRONZE:{minSavings:5e5,minScore:60}}}async getQualifiedLeads(){try{let{data:e,error:t}=await u.from("workflow_sessions").select(`
          id,
          company_name,
          business_type,
          import_volume,
          stage_completed,
          intelligence_level,
          created_at,
          metadata
        `).gte("stage_completed",3).order("created_at",{ascending:!1}).limit(20);if(t)return console.warn("Database query failed:",t),this.getDemoLeads();if(!e||0===e.length)return this.getDemoLeads();let a=await Promise.all(e.map(e=>this.processSessionIntoLead(e))),i=a.filter(e=>e.leadScore>=60);return{success:!0,leads:i,totalLeads:i.length,source:"database",lastUpdated:new Date().toISOString()}}catch(e){return console.error("Failed to get qualified leads:",e),this.getDemoLeads()}}async processSessionIntoLead(e){let t=this.calculateSavingsPotential(e),a=this.calculateLeadScore(e,t),i=this.determineTier(t.totalSavings,a),s=this.getFeeRate(i),n=Math.round(t.totalSavings*s),r=this.calculateUrgency(e,t),o=this.estimateTimeline(e,i),l=this.extractSpecialistRequirements(e,t);return{id:`lead_${e.id}`,companyName:e.company_name||"Confidential Company",businessType:e.business_type||"Manufacturing",importVolume:e.import_volume||"$1M - $5M",supplierCountry:e.metadata?.supply_chain?.primarySupplier||"China",totalSavings:t.totalSavings,specialistFeePool:n,leadScore:a,tier:i,timeline:o,status:"NEW",submittedAt:new Date(e.created_at),route:t.recommendedRoute,urgency:r,requirements:l,stageCompleted:e.stage_completed,intelligenceLevel:e.intelligence_level,metadata:{state:e.metadata?.geographic?.state,city:e.metadata?.geographic?.city,sessionId:e.id,calculatorCompleted:e.stage_completed>=5}}}calculateSavingsPotential(e){let t=e.business_type||"Manufacturing",a=e.import_volume||"$1M - $5M",i={Electronics:.15,Manufacturing:.12,Automotive:.18,Medical:.1,Textiles:.22,Machinery:.14}[t]||.12,s={"Under $500K":4e5,"$500K - $1M":75e4,"$1M - $5M":3e6,"$5M - $25M":15e6,"$25M+":4e7}[a]||3e6,n=e.metadata?.geographic?.state,r=["CA","WA","OR","NV","AZ"].includes(n),o=["NY","FL","MA","NC","SC","GA","ME","VT","NH"].includes(n),l="Canada-Mexico Triangle";return r&&"Manufacturing"===t?l="Mexico Fast Track":o&&"Electronics"===t?l="Canada Preferred":"Automotive"===t&&(l="Mexico Automotive Corridor"),{totalSavings:Math.round(s*i),savingsRate:i,volumeBase:s,recommendedRoute:l}}calculateLeadScore(e,t){let a;a=50+Math.min(8*e.stage_completed,32),t.totalSavings>1e7?a+=20:t.totalSavings>5e6?a+=15:t.totalSavings>2e6?a+=10:t.totalSavings>5e5&&(a+=5),a+=(({Electronics:15,Automotive:18,Manufacturing:12,Medical:8,Textiles:20,Machinery:10})[e.business_type]||10)+Math.min(2*e.intelligence_level,10);let i=e.metadata?.geographic?.state;["CA","TX","NY","FL","WA","IL"].includes(i)&&(a+=8);let s=e.metadata?.priorities?.timeline;return"immediate"===s?a+=10:"within_3_months"===s?a+=7:"within_6_months"===s&&(a+=5),Math.min(100,Math.max(0,Math.round(a)))}determineTier(e,t){return e>=this.qualificationThresholds.PLATINUM.minSavings&&t>=this.qualificationThresholds.PLATINUM.minScore?"PLATINUM":e>=this.qualificationThresholds.GOLD.minSavings&&t>=this.qualificationThresholds.GOLD.minScore?"GOLD":e>=this.qualificationThresholds.SILVER.minSavings&&t>=this.qualificationThresholds.SILVER.minScore?"SILVER":e>=this.qualificationThresholds.BRONZE.minSavings&&t>=this.qualificationThresholds.BRONZE.minScore?"BRONZE":"UNQUALIFIED"}getFeeRate(e){return({PLATINUM:.025,GOLD:.02,SILVER:.018,BRONZE:.015})[e]||.015}calculateUrgency(e,t){let a=e.metadata?.priorities?.timeline,i=e.stage_completed,s=t.totalSavings;return"immediate"===a||s>15e6||"within_3_months"===a&&i>=7?"HIGH":"within_6_months"===a||i>=5?"MEDIUM":"LOW"}estimateTimeline(e,t){let a=e.business_type,i={Electronics:"4-6 months",Manufacturing:"5-7 months",Automotive:"3-5 months",Medical:"6-9 months",Textiles:"2-4 months",Machinery:"4-6 months"}[a]||"4-6 months";return"PLATINUM"===t?i.replace(/(\d+)-(\d+)/,(e,t,a)=>`${Math.max(1,parseInt(t)-1)}-${Math.max(2,parseInt(a)-1)}`):i}extractSpecialistRequirements(e,t){let a=[],i=e.business_type,s=t.recommendedRoute;return"Manufacturing"===i&&a.push("Maquiladora setup","Manufacturing permits"),"Electronics"===i&&a.push("Electronics compliance","Quality certifications"),"Automotive"===i&&a.push("Automotive corridor","Just-in-time logistics"),"Medical"===i&&a.push("Medical device regulations","FDA coordination"),s.includes("Mexico")&&a.push("USMCA compliance","Cultural coordination"),s.includes("Fast Track")&&a.push("Speed implementation","Government relations"),a.push("Cross-border logistics"),a.slice(0,4)}getDemoLeads(){let e=[{id:"demo_001",companyName:"TechCorp Electronics Ltd",businessType:"Electronics",importVolume:"$5M - $25M",supplierCountry:"China",totalSavings:11e6,specialistFeePool:275e3,leadScore:95,tier:"PLATINUM",timeline:"4-5 months",status:"NEW",submittedAt:new Date(Date.now()-72e5),route:"Mexico Preferred",urgency:"HIGH",requirements:["Maquiladora setup","USMCA compliance","Cultural coordination","Electronics compliance"],stageCompleted:9,intelligenceLevel:10},{id:"demo_002",companyName:"Advanced Manufacturing Inc",businessType:"Manufacturing",importVolume:"$1M - $5M",supplierCountry:"Taiwan",totalSavings:32e5,specialistFeePool:8e4,leadScore:78,tier:"SILVER",timeline:"6-7 months",status:"NEW",submittedAt:new Date(Date.now()-18e6),route:"Canada-Mexico Triangle",urgency:"MEDIUM",requirements:["Cross-border logistics","Tariff optimization","Manufacturing permits"],stageCompleted:6,intelligenceLevel:6}];return{success:!0,leads:e,totalLeads:e.length,source:"demo_data",lastUpdated:new Date().toISOString()}}async claimLead(e,t="default_specialist"){try{return{success:!0,message:"Lead claimed successfully",leadId:e,claimedBy:t,claimedAt:new Date().toISOString(),nextSteps:["Contact Mexican maquiladora specialists","Prepare implementation proposal","Coordinate with Canadian logistics team","Schedule client discovery call"]}}catch(e){return{success:!1,error:"Failed to claim lead",details:e.message}}}async getSpecialistMetrics(e="default_specialist"){return{totalLeadsClaimed:12,totalRevenue:89e4,averageLeadValue:74167,successRate:91,currentActiveLead:3,monthlyGrowth:23,topTier:"PLATINUM",specialistRating:4.8}}};async function handler(e,t){let a=new SpecialistLeadEngine;try{switch(e.method){case"GET":if("metrics"===e.query.action){let i=await a.getSpecialistMetrics(e.query.specialist_id);return t.status(200).json(i)}let i=await a.getQualifiedLeads();return t.status(200).json(i);case"POST":if("claim"===e.query.action){let{leadId:i,specialistId:s}=e.body,n=await a.claimLead(i,s);return t.status(200).json(n)}if("marketplace"===e.query.action){let{userData:a,requestType:i="qualification",includeAlertsIntelligence:s=!1,hindsightAnalysis:n=null}=e.body;if(!a)return t.status(400).json({error:"Missing user data"});console.log("\uD83D\uDCB0 SPECIALIST MARKETPLACE: Processing request"),console.log(`ðŸŽ¯ Request Type: ${i}`),console.log("\uD83D\uDCCA Company Profile:",{businessType:a.businessType,importVolume:a.importVolume,supplierCountry:a.primarySupplierCountry});let r=await l.Z.calculateUMCAAdvantage(a);if(!r.success)return t.status(500).json({error:"Failed to calculate USMCA advantage",details:r.error});let o=c.Z.qualifyLead(a,r.advantage);console.log(`ðŸ’Ž LEAD QUALIFIED: Score ${o.leadScore}/100`),console.log(`ðŸ’° SPECIALIST FEE POTENTIAL: $${o.specialistFeeEstimate.toLocaleString()}`);let u=null;return s&&(u=await Object(function(){var e=Error("Cannot find module '../../lib/predictive-alerts-network-intelligence.js'");throw e.code="MODULE_NOT_FOUND",e}())(a,n)),t.status(200).json({success:!0,usmca_advantage:r.advantage,lead_qualification:o,specialist_marketplace:{qualified:o.isQualified,tier:o.tier,estimated_specialist_fee:o.specialistFeeEstimate,connection_priority:o.connectionPriority,next_steps:o.nextSteps},predictive_intelligence:u,marketplace_ready:o.isQualified&&o.leadScore>=70})}return t.status(400).json({success:!1,error:"Invalid POST action. Supported actions: claim, marketplace"});default:return t.status(405).json({success:!1,error:"Method not allowed"})}}catch(e){return console.error("API Error:",e),t.status(500).json({success:!1,error:"Internal server error",details:e.message})}}let d=(0,r.l)(i,"default"),m=(0,r.l)(i,"config"),p=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/specialist-leads",pathname:"/api/specialist-leads",bundlePath:"",filename:""},userland:i})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222,6553,5246,8602],()=>__webpack_exec__(8146));module.exports=a})();