"use strict";(()=>{var e={};e.id=4633,e.ids=[4633],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1466:(e,r,t)=>{t.r(r),t.d(r,{config:()=>c,default:()=>o,routeModule:()=>d});var a={};t.r(a),t.d(a,{default:()=>handler});var i=t(1802),s=t(7153),n=t(6249);async function handler(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let{origin:t,destination:a,weight:i,dimensions:s}=e.body;if(!t||!a)return r.status(400).json({error:"Missing origin or destination"});console.log("\uD83D\uDEA2 SHIPPO API: Fetching shipping rates",{origin:t,destination:a,weight:i});let n=process.env.SHIPPO_API_KEY&&"true"!==process.env.USE_MOCK_APIS&&"true"!==process.env.USE_MOCK;if(n){let e=normalizeAddress(t),n=normalizeAddress(a),o={address_from:e,address_to:n,parcels:[{length:s?.length||"10",width:s?.width||"10",height:s?.height||"10",distance_unit:"in",weight:i||"1",mass_unit:"lb"}],async:!1};console.log("\uD83D\uDCE1 Making real Shippo API call..."),console.log("\uD83D\uDCE6 Shippo request data:",JSON.stringify(o,null,2));let c=await fetch("https://api.goshippo.com/shipments/",{method:"POST",headers:{Authorization:`ShippoToken ${process.env.SHIPPO_API_KEY}`,"Content-Type":"application/json"},body:JSON.stringify(o),timeout:1e4});if(!c.ok)throw Error(`Shippo API error: ${c.status}`);let d=await c.json();console.log("\uD83D\uDCE6 Raw Shippo response:",JSON.stringify(d,null,2));let u=(d.rates||[]).map(e=>({carrier:e.provider||"Unknown",service:e.servicelevel?.name||"Standard",rate:e.amount||"0.00",currency:e.currency||"USD",transitTime:e.estimated_days?`${e.estimated_days} days`:"Unknown",reliability:"API_VERIFIED",shippoRateId:e.object_id}));return console.log("✅ Real Shippo data retrieved",{origin:t,destination:a,options:u.length,rawRates:d.rates?.length||0}),r.status(200).json({success:!0,source:"SHIPPO_API",origin:t,destination:a,shippingOptions:u,transitAnalysis:analyzeTransitOptions(u,t,a),timestamp:new Date().toISOString(),cacheFor:144e5})}{console.log("\uD83D\uDCCA Using fallback shipping data (API disabled)");let e=function(e,r,t){let a={"CN-US":[{carrier:"Ocean",service:"Standard",base:2200,transit:"18-25 days"},{carrier:"Ocean",service:"Express",base:2800,transit:"12-16 days"},{carrier:"Air",service:"Standard",base:4500,transit:"5-7 days"},{carrier:"Air",service:"Express",base:6200,transit:"2-3 days"}],"CN-MX":[{carrier:"Ocean",service:"Standard",base:1900,transit:"16-22 days"},{carrier:"Ocean",service:"Express",base:2400,transit:"10-14 days"},{carrier:"Air",service:"Standard",base:3800,transit:"4-6 days"}],"CN-CA":[{carrier:"Ocean",service:"Standard",base:2100,transit:"17-24 days"},{carrier:"Ocean",service:"Express",base:2700,transit:"11-15 days"},{carrier:"Air",service:"Standard",base:4200,transit:"4-6 days"}],"IN-US":[{carrier:"Ocean",service:"Standard",base:2400,transit:"20-28 days"},{carrier:"Ocean",service:"Express",base:3e3,transit:"14-18 days"},{carrier:"Air",service:"Standard",base:4800,transit:"6-8 days"}],"VN-US":[{carrier:"Ocean",service:"Standard",base:2e3,transit:"16-23 days"},{carrier:"Ocean",service:"Express",base:2500,transit:"10-14 days"},{carrier:"Air",service:"Standard",base:4200,transit:"4-6 days"}]},i=`${e}-${r}`,s=a[i]||a["CN-US"];return s.map(e=>({carrier:e.carrier,service:e.service,rate:(e.base*(t||1)*(1+.2*Math.random())).toFixed(2),currency:"USD",transitTime:e.transit,reliability:"ESTIMATED",fuelSurcharge:(.15*e.base).toFixed(2),totalWithSurcharges:(e.base*(t||1)*1.25).toFixed(2)}))}(t,a,i);return r.status(200).json({success:!0,source:"FALLBACK_DATA",origin:t,destination:a,shippingOptions:e,transitAnalysis:analyzeTransitOptions(e,t,a),timestamp:new Date().toISOString(),cacheFor:144e5,note:"Using fallback data - enable SHIPPO_API_KEY for live rates"})}}catch(e){return console.error("❌ Shipping API error:",e),r.status(200).json({success:!1,error:e.message,fallback:[{carrier:"ESTIMATED",service:"Standard",rate:"2500.00",currency:"USD",transitTime:"14-21 days",reliability:"ESTIMATED"}],source:"EMERGENCY_FALLBACK",timestamp:new Date().toISOString()})}}function normalizeAddress(e){return"string"==typeof e?({CN:{country:"CN",city:"Shanghai"},China:{country:"CN",city:"Shanghai"},IN:{country:"IN",city:"Mumbai"},India:{country:"IN",city:"Mumbai"},VN:{country:"VN",city:"Ho Chi Minh City"},Vietnam:{country:"VN",city:"Ho Chi Minh City"},KR:{country:"KR",city:"Seoul"},Korea:{country:"KR",city:"Seoul"},JP:{country:"JP",city:"Tokyo"},Japan:{country:"JP",city:"Tokyo"},MX:{country:"MX",city:"Mexico City"},Mexico:{country:"MX",city:"Mexico City"},CA:{country:"CA",city:"Toronto"},Canada:{country:"CA",city:"Toronto"},US:{country:"US",city:"Los Angeles",state:"CA",zip:"90210"},USA:{country:"US",city:"Los Angeles",state:"CA",zip:"90210"}})[e]||{country:e,city:"Unknown"}:e}function analyzeTransitOptions(e,r,t){let a={fastestOption:null,cheapestOption:null,recommendedOption:null,routingAdvice:[],seasonalFactors:[]};return e&&e.length>0&&(a.fastestOption=e.reduce((e,r)=>{let t=extractTransitDays(r.transitTime),a=extractTransitDays(e.transitTime);return t<a?r:e}),a.cheapestOption=e.reduce((e,r)=>parseFloat(r.rate)<parseFloat(e.rate)?r:e),a.recommendedOption=e.find(e=>e.service.toLowerCase().includes("express")&&e.carrier.toLowerCase().includes("ocean"))||e[1]||e[0]),(r.includes("CN")||r.includes("China"))&&(a.routingAdvice.push("China routes benefit from West Coast ports (LA/Long Beach)"),a.routingAdvice.push("Consider Mexico routing for 25% tariff savings vs direct import")),t.includes("US")&&(a.routingAdvice.push("USMCA triangle routing can save 15-25% on total landed costs"),a.seasonalFactors.push("Q4 capacity constraints increase rates 20-30%")),a}function extractTransitDays(e){if(!e)return 999;let r=e.match(/(\d+)-?(\d+)?/);return r?parseInt(r[1]):999}let o=(0,n.l)(a,"default"),c=(0,n.l)(a,"config"),d=new i.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/intelligence/shipping",pathname:"/api/intelligence/shipping",bundlePath:"",filename:""},userland:a})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[4222],()=>__webpack_exec__(1466));module.exports=t})();