"use strict";(()=>{var e={};e.id=3695,e.ids=[3695],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5587:(e,t,a)=>{a.r(t),a.d(t,{config:()=>p,default:()=>l,routeModule:()=>d});var i={};a.r(i),a.d(i,{default:()=>handler});var n=a(1802),s=a(7153),r=a(6249),o=a(2885);let c=(0,o.createClient)("https://mrwitpgbcaxgnirqtavt.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function handler(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let{userProfile:a}=e.body;if(!a)return t.status(400).json({error:"User profile required"});try{let e=await generateLiveIntelligenceAlerts(a),i=await getNetworkActivity(a),n=await detectNewPatterns(a),s=await getMarketUpdates(a);return t.status(200).json({success:!0,alerts:e,networkActivity:i,newPatterns:n,marketUpdates:s,generatedAt:new Date().toISOString()})}catch(e){return console.error("Live alerts error:",e),t.status(500).json({error:"Failed to generate live alerts",details:e.message})}}async function generateLiveIntelligenceAlerts(e){let t=[],{data:a}=await c.from("workflow_sessions").select("data, stage_completed, created_at").eq("data->businessType",e.businessType).gte("created_at",new Date(Date.now()-6048e5).toISOString()).eq("stage_completed",8).order("created_at",{ascending:!1}).limit(10);if(a?.length>0){let i=a.reduce((e,t)=>e+(t.data?.stage3Data?.potentialSavings||0),0)/a.length;t.push({type:"success_pattern",priority:"medium",title:"Similar Companies Achieving Results",message:`${a.length} ${e.businessType} companies completed optimization this week`,impact:`Average savings: $${Math.round(i/1e3)}K`,timestamp:"Today",actionable:!0,action:"View Success Stories"})}let{data:i}=await c.from("hindsight_pattern_library").select("*").eq("business_type",e.businessType).gte("confidence_score",80).order("created_at",{ascending:!1}).limit(5);if(i?.length>0){let e=i[0];t.push({type:"pattern_insight",priority:"high",title:"New Optimization Pattern Detected",message:`Companies like yours are achieving ${e.confidence_score}% success with new approach`,impact:"Potential 15-25% improvement",timestamp:"6 hours ago",actionable:!0,action:"Apply Pattern"})}let n=new Date().getMonth();n>=9&&"Under $500K"!==e.importVolume&&t.push({type:"seasonal_opportunity",priority:"high",title:"Q4 Volume Surge - Act Now",message:"Historical data shows Q4 import volumes increase 35% - optimize capacity now",impact:`+$${Math.round(.35*e.potentialSavings/1e3)}K opportunity`,timestamp:"2 hours ago",actionable:!0,action:"Reserve Capacity"});let{data:s}=await c.from("marcus_consultations").select("recommendations, savings_identified").eq("business_profile->type",e.businessType).gte("created_at",new Date(Date.now()-2592e6).toISOString()).order("created_at",{ascending:!1}).limit(3);if(s?.length>0){let a=s.reduce((e,t)=>e+t.savings_identified,0)/s.length;t.push({type:"marcus_insight",priority:"medium",title:"Marcus AI Pattern Analysis",message:`Latest AI analysis identified optimization patterns in ${e.businessType} sector`,impact:`Average additional savings: $${Math.round(.15*a/1e3)}K`,timestamp:"1 day ago",actionable:!0,action:"Request Analysis"})}let{data:r}=await c.from("trade_flows").select("hs_code, trade_value, trade_flow").eq("usmca_qualified",!0).gte("trade_value",1e6).order("trade_value",{ascending:!1}).limit(20);if(r?.length>0){let a=r.filter(e=>e.trade_flow?.includes("Mexico")),i=r.filter(e=>e.trade_flow?.includes("Canada"));a.length>i.length&&"mexico_routing"!==e.selectedRoute&&t.push({type:"route_optimization",priority:"medium",title:"Route Optimization Available",message:"Trade flow analysis shows Mexico routing gaining momentum in your product categories",impact:"8-12% additional savings potential",timestamp:"4 hours ago",actionable:!0,action:"Analyze Route"})}return t.length>0?t:[{type:"monitoring_active",priority:"low",title:"Intelligence Monitoring Active",message:`Tracking optimization opportunities for ${e.businessType} businesses`,impact:"Continuous improvement",timestamp:"Now",actionable:!1,action:null},{type:"network_building",priority:"medium",title:"Network Intelligence Growing",message:"Each new user adds intelligence that benefits your optimization potential",impact:"Improving recommendations",timestamp:"1 hour ago",actionable:!0,action:"View Network"}]}async function getNetworkActivity(e){let{data:t}=await c.from("workflow_sessions").select("data, stage_completed, created_at").eq("data->businessType",e.businessType).gte("created_at",new Date(Date.now()-864e5).toISOString()).order("created_at",{ascending:!1}).limit(20),a=t?.length||0,i=t?.filter(e=>e.stage_completed>=8).length||0;return{activeBusinessesToday:a,completedOptimizations:i,networkGrowth:"+12% this week",connectionOpportunities:Math.min(5,Math.floor(a/3))}}async function detectNewPatterns(e){let{data:t}=await c.from("hindsight_pattern_library").select("*").gte("created_at",new Date(Date.now()-6048e5).toISOString()).eq("business_type",e.businessType).order("confidence_score",{ascending:!1}).limit(3);return t?.map(t=>({type:t.pattern_type,confidence:t.confidence_score,description:`New ${t.pattern_type} pattern detected with ${t.confidence_score}% confidence`,applicability:t.business_type===e.businessType?"High":"Medium"}))||[]}async function getMarketUpdates(e){let t=[],{data:a}=await c.from("current_market_alerts").select("*").gte("created_at",new Date(Date.now()-864e5).toISOString()).order("created_at",{ascending:!1}).limit(5);return a?.length>0&&a.forEach(a=>{(a.country===e.primarySupplierCountry||"TARIFF_CHANGE"===a.alert_type)&&t.push({type:a.alert_type,country:a.country,impact:`Rate change: ${a.previous_rate}% â†’ ${a.current_rate}%`,relevance:"High",message:a.alert_message})}),t}let l=(0,r.l)(i,"default"),p=(0,r.l)(i,"config"),d=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/intelligence/live-alerts",pathname:"/api/intelligence/live-alerts",bundlePath:"",filename:""},userland:i})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222],()=>__webpack_exec__(5587));module.exports=a})();