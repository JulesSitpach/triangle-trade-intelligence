"use strict";(()=>{var e={};e.id=4532,e.ids=[4532],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},8353:(e,t,a)=>{a.r(t),a.d(t,{config:()=>c,default:()=>o,routeModule:()=>u});var r={};a.r(r),a.d(r,{default:()=>handler});var i=a(1802),n=a(7153),l=a(6249),s=a(2885);let d=(0,s.createClient)("https://mrwitpgbcaxgnirqtavt.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function handler(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let{hsCode:a="8471",origin:r="China",destination:i="USA",businessType:n="Electronics",importVolume:l=1e6}=e.body;console.log(`ðŸŽ¯ CLEAN ROUTING: ${r} â†’ ${i} | ${n} | ${a}`);try{let{data:e,error:s}=await d.from("trade_flows").select("*").ilike("reporter_country",`%${r}%`).ilike("partner_country",`%${i}%`).limit(10);if(s)throw s;let{data:o,error:c}=await d.from("trade_flows").select("*").ilike("reporter_country",`%${r}%`).in("partner_country",["Mexico","Canada"]).limit(20);if(c)throw c;let{data:u,error:g}=await d.from("trade_flows").select("product_category, trade_value, reporter_country, partner_country").ilike("product_category",`%${n}%`).order("trade_value",{ascending:!1}).limit(5),h=[],m=o?.filter(e=>e.partner_country?.includes("Mexico"))||[];if(m.length>0){let e=m.reduce((e,t)=>e+(t.triangle_savings_realized||0),0)/m.length,t=m.reduce((e,t)=>e+(t.trade_value||0),0);h.push({id:"mexico_triangle",name:`${r} â†’ Mexico â†’ USA`,description:`Triangle route validated with ${m.length} trade records worth $${(t/1e6).toFixed(0)}M`,transitTime:"28-35 days",complexity:"Medium",savings:`$${Math.round(.15*l/1e3)}K annually`,tariffRate:"0% (USMCA)",recommended:!0,databaseValidated:!0,intelligence:{tradeRecords:m.length,avgHistoricalSavings:Math.round(e),totalHistoricalValue:Math.round(t),confidence:m.length>5?"High":"Medium"}})}let p=o?.filter(e=>e.partner_country?.includes("Canada"))||[];if(p.length>0){let e=p.reduce((e,t)=>e+(t.triangle_savings_realized||0),0)/p.length,t=p.reduce((e,t)=>e+(t.trade_value||0),0);h.push({id:"canada_triangle",name:`${r} â†’ Canada â†’ USA`,description:`Alternative USMCA route with ${p.length} historical records`,transitTime:"25-32 days",complexity:"Medium",savings:`$${Math.round(.12*l/1e3)}K annually`,tariffRate:"0% (USMCA)",recommended:!1,databaseValidated:!0,intelligence:{tradeRecords:p.length,avgHistoricalSavings:Math.round(e),totalHistoricalValue:Math.round(t),confidence:p.length>5?"High":"Medium"}})}h.push({id:"direct_route",name:`${r} â†’ USA Direct`,description:`Direct shipping route with ${e?.length||0} historical records`,transitTime:"18-25 days",complexity:"Low",savings:"$0 (baseline)",tariffRate:"25% (bilateral)",recommended:!1,databaseValidated:e?.length>0,intelligence:{tradeRecords:e?.length||0,note:"Higher tariffs but faster transit"}});let _=[],f=h.find(e=>e.recommended);if(f&&_.push(`ðŸŽ¯ Recommended: ${f.name} saves ${f.savings} based on ${f.intelligence.tradeRecords} historical trade records`),u?.length>0){let e=u.reduce((e,t)=>e+(t.triangle_savings_realized||0),0)/u.length;_.push(`ðŸ“Š Industry Intelligence: Similar ${n} companies achieved average savings of $${Math.round(e/1e3)}K`)}return t.status(200).json({success:!0,routes:h,intelligence:{source:"Triangle Intelligence 597K Database (REAL)",directFlows:e?.length||0,triangleFlows:o?.length||0,businessIntelligence:u?.length||0,confidence:h.filter(e=>e.databaseValidated).length/h.length,marcusInsights:_},query:{hsCode:a,origin:r,destination:i,businessType:n}})}catch(e){return console.error("âŒ Clean Routing API Error:",e.message),t.status(500).json({error:"Database query failed",message:e.message})}}let o=(0,l.l)(r,"default"),c=(0,l.l)(r,"config"),u=new i.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/intelligence/routing-clean",pathname:"/api/intelligence/routing-clean",bundlePath:"",filename:""},userland:r})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222],()=>__webpack_exec__(8353));module.exports=a})();