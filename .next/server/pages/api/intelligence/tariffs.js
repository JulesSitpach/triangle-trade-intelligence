"use strict";(()=>{var e={};e.id=8089,e.ids=[8089],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7886:(e,t,a)=>{a.r(t),a.d(t,{config:()=>i,default:()=>u,routeModule:()=>c});var r={};a.r(r),a.d(r,{default:()=>handler});var o=a(1802),s=a(7153),n=a(6249);async function handler(e,t){if("POST"!==e.method&&"GET"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let a="GET"===e.method?e.query.country:e.body?.country,r="GET"===e.method?e.query.product:e.body?.product;if(!a||!r)return t.status(400).json({error:"Missing country or product parameter"});console.log("\uD83C\uDF10 COMTRADE API: Fetching tariff data",{country:a,product:r}),console.log("Environment check:",{COMTRADE_API_KEY:!!process.env.COMTRADE_API_KEY,USE_MOCK_APIS:process.env.USE_MOCK_APIS,USE_MOCK:process.env.USE_MOCK});let o=process.env.COMTRADE_API_KEY&&"true"!==process.env.USE_MOCK_APIS&&"true"!==process.env.USE_MOCK;if(o){let e="CN"===a?"156":"IN"===a?"699":"MX"===a?"484":"CA"===a?"124":"VN"===a?"704":"0",o=new URLSearchParams({r:"842",p:e,ps:"2023",px:"HS",rg:"1",cc:"TOTAL",max:"500"}),s=`https://comtradeapi.un.org/data/v1/get/C/A/HS?${o}`;console.log("\uD83D\uDCE1 Making real Comtrade API call");let n={"Ocp-Apim-Subscription-Key":process.env.COMTRADE_API_KEY},u=await fetch(s,{headers:n,timeout:1e4});if(!u.ok)throw Error(`Comtrade API error: ${u.status}`);let i=await u.json(),c=function(e,t,a){if(!e.data||!Array.isArray(e.data))return{rate:20,status:"NO_DATA",note:"No Comtrade data available"};let r=e.data.find(e=>e.ptCode===t||e.ptTitle?.includes({CN:"China",IN:"India",MX:"Mexico",CA:"Canada",VN:"Vietnam",KR:"Korea",JP:"Japan"}[t]||t));if(!r)return{rate:20,status:"COUNTRY_NOT_FOUND",note:"Country not in dataset"};let o=function(e){if(e.customsValue&&e.tradeValue){let t=e.tradeValue-e.customsValue,a=t/e.customsValue*100;return Math.max(0,Math.min(100,a))}return 15}(r);return{rate:o,status:"COMTRADE_OFFICIAL",note:"Official UN Comtrade data",tradeValue:r.tradeValue,netWeight:r.netWgt,dataYear:r.period}}(i,a,0);return console.log("✅ Real Comtrade data retrieved",{country:a,tariff:c.rate}),t.status(200).json({success:!0,source:"UN_COMTRADE_API",country:a,product:r,tariff:c,timestamp:new Date().toISOString(),cacheFor:36e5})}{console.log("\uD83D\uDCCA Using fallback tariff data (API disabled)");let e={CN:{rate:25,status:"HIGH_VOLATILITY",note:"Subject to trade tensions"},IN:{rate:50,status:"VERY_HIGH",note:"Recent doubling due to policy change"},VN:{rate:15,status:"MODERATE",note:"Growing trade relationship"},KR:{rate:8,status:"STABLE",note:"KORUS FTA benefits"},JP:{rate:12,status:"STABLE",note:"Long-term trade partner"},EU:{rate:18,status:"MODERATE",note:"Various EU regulations"},UK:{rate:10,status:"STABLE",note:"Post-Brexit agreement"},MX:{rate:0,status:"USMCA",note:"USMCA 0% tariff"},CA:{rate:0,status:"USMCA",note:"USMCA 0% tariff"}}[a]||{rate:20,status:"UNKNOWN",note:"Standard MFN rate"};return t.status(200).json({success:!0,source:"FALLBACK_DATA",country:a,product:r,tariff:e,timestamp:new Date().toISOString(),cacheFor:36e5,note:"Using fallback data - enable COMTRADE_API_KEY for live data"})}}catch(e){return console.error("❌ Tariff API error:",e),t.status(200).json({success:!1,error:e.message,fallback:{rate:25,status:"ESTIMATED",note:"Emergency fallback rate due to API failure"},source:"EMERGENCY_FALLBACK",timestamp:new Date().toISOString()})}}let u=(0,n.l)(r,"default"),i=(0,n.l)(r,"config"),c=new o.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/intelligence/tariffs",pathname:"/api/intelligence/tariffs",bundlePath:"",filename:""},userland:r})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222],()=>__webpack_exec__(7886));module.exports=a})();