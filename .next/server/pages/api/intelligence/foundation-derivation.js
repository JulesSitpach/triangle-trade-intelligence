"use strict";(()=>{var e={};e.id=7515,e.ids=[7515],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3541:(e,a,n)=>{n.r(a),n.d(a,{config:()=>l,default:()=>u,routeModule:()=>d});var i={};n.r(i),n.d(i,{default:()=>handler});var t=n(1802),r=n(7153),o=n(6249),s=n(6553),c=n(7309);async function handler(e,a){if("POST"!==e.method)return a.status(405).json({error:"Method not allowed"});try{console.log("\uD83E\uDDE0 Stage 1 Intelligence Derivation:",e.body);let{companyName:n,businessType:i,zipCode:t,primarySupplierCountry:r,importVolume:o,timelinePriority:s}=e.body,c=await deriveGeographicFromDatabase(t),u=await deriveBusinessPatternsFromDatabase(i),l=await deriveOptimalRoutingFromDatabase(r,c,i),d=(c?4:0)+(u?5:0)+(l?6:0)+3,g={geographic:c,patterns:u,routing:l,enhanced:{databaseDriven:!0,apiEnhanced:!1,confidence:l?.routeConfidence||85},dataPointsGenerated:d,timestamp:new Date().toISOString()};return console.log(`✅ Stage 1 Intelligence Generated: ${d} data points`),a.status(200).json(g)}catch(e){return console.error("❌ Stage 1 Intelligence Derivation Error:",e),a.status(200).json({geographic:{error:"Database unavailable",fallback:!0},patterns:{error:"Database unavailable",fallback:!0},routing:{error:"Database unavailable",fallback:!0},enhanced:{databaseDriven:!1,fallback:!0},dataPointsGenerated:0,timestamp:new Date().toISOString()})}}async function deriveGeographicFromDatabase(e){try{console.log(`🌍 Dynamic geographic derivation for: ${e}`);let a=await c.$3.getPortInfo(),n=/^[A-Z]\d[A-Z]\s?\d[A-Z]\d$/i.test(e),i=/^\d{5}(-\d{4})?$/.test(e),t={source:"dynamic_detection",ports:["Various"]};if(n){console.log("\uD83C\uDDE8\uD83C\uDDE6 Detected Canadian postal code");let a=e.charAt(0).toUpperCase(),n={A:{region:"Atlantic Canada",province:"NL/NB/NS/PE"},B:{region:"Atlantic Canada",province:"NS"},C:{region:"Atlantic Canada",province:"PE"},E:{region:"Atlantic Canada",province:"NB"},G:{region:"Eastern Quebec",province:"QC"},H:{region:"Montreal Area",province:"QC"},J:{region:"Western Quebec",province:"QC"},K:{region:"Eastern Ontario",province:"ON"},L:{region:"Central Ontario",province:"ON"},M:{region:"Toronto Area",province:"ON"},N:{region:"Southwestern Ontario",province:"ON"},P:{region:"Northern Ontario",province:"ON"},R:{region:"Manitoba",province:"MB"},S:{region:"Saskatchewan",province:"SK"},T:{region:"Alberta",province:"AB"},V:{region:"British Columbia",province:"BC"},X:{region:"Northwest Territories/Nunavut",province:"NT/NU"},Y:{region:"Yukon",province:"YT"}}[a];t={country:"Canada",region:n?.region||"Canada",province:n?.province||"CA",city:n?.region||"Canadian Location",usmcaAdvantage:!0,source:"dynamic_canadian_detection"}}else if(i){console.log("\uD83C\uDDFA\uD83C\uDDF8 Detected US ZIP code");let a=parseInt(e.substring(0,3)),n="Continental US";a>=900&&a<=999?n="West Coast":a>=800&&a<=899?n="Mountain West":a>=700&&a<=799?n="South Central":a>=600&&a<=699?n="Midwest":a>=500&&a<=599?n="South Central":a>=400&&a<=499?n="Southeast":a>=300&&a<=399?n="Southeast":a>=200&&a<=299?n="Mid-Atlantic":a>=100&&a<=199?n="Northeast":a>=0&&a<=99&&(n="Northeast"),t={country:"United States",region:n,state:"US",city:`${n} Area`,source:"dynamic_zip_detection"}}else console.log("\uD83C\uDF0D Unknown postal code format, using fallback"),t={country:"Unknown",region:"Unknown Location",state:"Unknown",city:"Unknown Location",source:"fallback_detection"};if(a.ports?.length>0){let e=a.ports.filter(e=>{let a=e.region?.toLowerCase()||"",n=t.region.toLowerCase();return a.includes(n.split(" ")[0])||n.includes(a.split(" ")[0])});t.ports=e.length>0?e.map(e=>e.port_name):["Various Ports"]}return console.log(`✅ Dynamic geographic result:`,t),t}catch(e){return console.error("❌ Geographic derivation error:",e),{country:"Unknown",region:"Unknown",state:"Unknown",city:"Unknown",ports:["Various"],source:"error_fallback"}}}async function deriveBusinessPatternsFromDatabase(e){try{console.log(`🏢 Dynamic business pattern derivation for: ${e}`);let a=await c.$3.getUSMCABusinessIntelligence(e);if(a.patterns?.length>0){let e=a.patterns[0];return console.log("✅ Found database business pattern"),{seasonal:e.seasonal_pattern||"CONSISTENT",specialRequirements:e.special_requirements?.split(",")||["Standard Handling"],typicalMargin:e.typical_margin||"15-25%",riskProfile:e.risk_profile||"Standard business risk",successRate:e.success_rate_percentage||85,avgSavings:e.avg_usmca_savings||25e4,source:"usmca_business_intelligence"}}console.log("\uD83D\uDCCA Generating dynamic business pattern analysis");let n=e.toLowerCase(),i="CONSISTENT",t=["Standard Handling"],r="Standard business risk",o=75,s=2e5;return n.includes("electronic")||n.includes("tech")?i="Q4_HEAVY":n.includes("automotive")||n.includes("auto")?i="Q2_Q3_HEAVY":n.includes("fashion")||n.includes("apparel")?i="Q1_HEAVY":(n.includes("toy")||n.includes("gift"))&&(i="Q4_HEAVY"),n.includes("electronic")||n.includes("tech")?(t=["Static Sensitive","Temperature Control"],o=85,s=275e3):n.includes("medical")||n.includes("pharma")?(t=["Temperature Control","FDA Compliance","Pharmaceutical"],o=82,s=32e4,r="Regulatory compliance critical"):n.includes("automotive")?(t=["Heavy Freight","JIT Delivery","Oversized Handling"],o=90,s=12e5,r="Supply chain timing critical"):n.includes("food")||n.includes("beverage")?(t=["Temperature Control","Perishable","FDA Compliance"],r="Time sensitive"):n.includes("chemical")&&(t=["Hazmat","Special Handling","Regulatory Compliance"],r="Regulatory intensive"),{seasonal:i,specialRequirements:t,typicalMargin:"15-25%",riskProfile:r,successRate:o,avgSavings:s,source:"dynamic_business_analysis"}}catch(e){return console.error("❌ Business patterns derivation error:",e),{seasonal:"VARIABLE",specialRequirements:["Standard"],typicalMargin:"15-25%",riskProfile:"Standard",successRate:70,avgSavings:15e4,source:"error_fallback"}}}async function deriveOptimalRoutingFromDatabase(e,a,n){try{let i,t,r,o;console.log(`🚛 Dynamic routing derivation: ${e} → ${a?.country} (${n})`);let s=await c.$3.getTriangleRoutingOpportunities(n);if(s.opportunities?.length>0){let a=s.opportunities[0];return console.log("✅ Found database routing data"),{recommendedRoute:a.optimal_route||`${e} → Mexico → USA (USMCA Triangle)`,transitTime:a.transit_time||"⚡ 14-18 days via USMCA corridor",routeConfidence:a.success_rate||92,savings:`Max savings: $${a.max_savings_amount||5e5}`,advantage:`${a.origin_country||e} → ${a.destination_country||"USA"} optimized`,source:"triangle_routing_database"}}console.log("\uD83D\uDCCA Generating dynamic routing analysis");let u=a?.country==="Canada";a?.country,u?"TW"===e?(i="Taiwan → Canada (USMCA Direct)",t=96,r="\uD83C\uDDE8\uD83C\uDDE6 Taiwan tech excellence + Canadian USMCA corridor + WTO trade benefits",o="WTO + USMCA 0% vs 25% bilateral tariffs"):"CN"===e?(i="China → Mexico → Canada (USMCA Triangle)",t=94,r="\uD83C\uDDE8\uD83C\uDDE6 Avoid China tariffs via Mexico + Canadian USMCA advantages",o="USMCA 0% vs 30% China tariffs"):(i=`${e} → Canada (USMCA Direct)`,t=90,r="\uD83C\uDDE8\uD83C\uDDE6 Canadian USMCA corridor + trade expertise",o="USMCA preferential rates"):"CN"===e?(i="China → Mexico → USA (USMCA Triangle)",t=92,r="\uD83C\uDDF2\uD83C\uDDFD Avoid 30% China tariffs via Mexico manufacturing hub",o="USMCA 0% vs 30% China tariffs"):["IN","VN","TH","MY"].includes(e)?(i=`${e} → Mexico → USA (USMCA Triangle)`,t=88,r="\uD83C\uDDF2\uD83C\uDDFD Asian manufacturing quality + Mexico USMCA benefits",o="USMCA corridor optimization"):(i=`${e} → USA (Direct/Optimized)`,t=85,r="\uD83C\uDDFA\uD83C\uDDF8 Direct routing with trade optimization",o="Optimized trade route");let l="⚡ 14-18 days via USMCA corridor";return i.includes("Direct")?l="⚡ 12-16 days direct routing":i.includes("Triangle")&&(l="⚡ 16-22 days triangle routing"),{recommendedRoute:i,transitTime:l,routeConfidence:t,savings:o,advantage:r,source:"dynamic_routing_analysis"}}catch(a){return console.error("❌ Routing derivation error:",a),{recommendedRoute:`${e} → Optimized Route`,transitTime:"⚡ Dynamic routing",routeConfidence:80,savings:"Trade optimization",advantage:"\uD83C\uDF0D Global trade corridor",source:"error_fallback"}}}(0,s.Ng)();let u=(0,o.l)(i,"default"),l=(0,o.l)(i,"config"),d=new t.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/intelligence/foundation-derivation",pathname:"/api/intelligence/foundation-derivation",bundlePath:"",filename:""},userland:i})}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),n=a.X(0,[4222,6553,7309],()=>__webpack_exec__(3541));module.exports=n})();