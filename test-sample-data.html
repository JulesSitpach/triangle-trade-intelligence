<!DOCTYPE html>
<html>
<head>
    <title>Test Sample Data - Triangle Intelligence</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { color: green; }
        .error { color: red; }
        .loading { color: blue; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto; max-height: 200px; }
        .summary { background: #e8f5e9; padding: 15px; border-radius: 8px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Triangle Intelligence - Sample Data Test</h1>
    <p>Testing all API endpoints with newly added sample data...</p>

    <div class="test-section">
        <h3>ğŸ“Š Service Requests API (Jorge's Components)</h3>
        <div id="service-requests-status" class="loading">Testing...</div>
        <pre id="service-requests-data"></pre>
    </div>

    <div class="test-section">
        <h3>ğŸš¢ Broker Operations API (Cristina's Components)</h3>
        <div id="broker-operations-status" class="loading">Testing...</div>
        <pre id="broker-operations-data"></pre>
    </div>

    <div class="test-section">
        <h3>ğŸ’¼ Professional Services API</h3>
        <div id="professional-services-status" class="loading">Testing...</div>
        <pre id="professional-services-data"></pre>
    </div>

    <div class="test-section">
        <h3>ğŸ“ˆ Workflow Analytics API</h3>
        <div id="workflow-analytics-status" class="loading">Testing...</div>
        <pre id="workflow-analytics-data"></pre>
    </div>

    <div class="test-section">
        <h3>ğŸ” Market Intelligence API</h3>
        <div id="market-intelligence-status" class="loading">Testing...</div>
        <pre id="market-intelligence-data"></pre>
    </div>

    <div id="summary" class="summary" style="display: none;">
        <h3>ğŸ“Š Test Summary</h3>
        <div id="summary-content"></div>
    </div>

    <script>
        async function testAPI(endpoint, statusElementId, dataElementId) {
            const statusElement = document.getElementById(statusElementId);
            const dataElement = document.getElementById(dataElementId);

            try {
                statusElement.textContent = 'Loading...';
                statusElement.className = 'loading';

                const response = await fetch(`http://localhost:3001${endpoint}`);
                const data = await response.json();

                if (response.ok) {
                    statusElement.textContent = `âœ… SUCCESS - ${response.status}`;
                    statusElement.className = 'success';

                    // Show key metrics from the response
                    let summary = '';
                    if (endpoint.includes('service-requests')) {
                        const requests = data.requests || [];
                        const jorgeRequests = requests.filter(r => r.assigned_to === 'Jorge').length;
                        const cristinaRequests = requests.filter(r => r.assigned_to === 'Cristina').length;
                        summary = `Total: ${requests.length} requests (Jorge: ${jorgeRequests}, Cristina: ${cristinaRequests})`;
                    } else if (endpoint.includes('broker-operations')) {
                        const operations = data.operations || [];
                        summary = `Total: ${operations.length} operations`;
                    } else if (endpoint.includes('professional-services')) {
                        const jorge = data.jorge_consultation_pipeline || [];
                        const cristina = data.cristina_service_delivery || [];
                        summary = `Jorge: ${jorge.length} services, Cristina: ${cristina.length} services`;
                    } else if (endpoint.includes('workflow-analytics')) {
                        summary = `${data.total_workflows} workflows, $${data.total_savings_generated?.toLocaleString()} savings`;
                    } else if (endpoint.includes('market-intelligence')) {
                        const intelligence = data.intelligence || [];
                        summary = `${intelligence.length} intelligence records`;
                    }

                    dataElement.textContent = summary + '\n\n' + JSON.stringify(data, null, 2).substring(0, 800) + '...';
                } else {
                    statusElement.textContent = `âŒ ERROR - ${response.status}`;
                    statusElement.className = 'error';
                    dataElement.textContent = JSON.stringify(data, null, 2);
                }

                return response.ok;
            } catch (error) {
                statusElement.textContent = `âŒ ERROR - ${error.message}`;
                statusElement.className = 'error';
                dataElement.textContent = error.message;
                return false;
            }
        }

        async function runAllTests() {
            console.log('ğŸ§ª Starting comprehensive API tests...');

            const tests = [
                { endpoint: '/api/admin/service-requests', status: 'service-requests-status', data: 'service-requests-data' },
                { endpoint: '/api/admin/broker-operations', status: 'broker-operations-status', data: 'broker-operations-data' },
                { endpoint: '/api/admin/professional-services', status: 'professional-services-status', data: 'professional-services-data' },
                { endpoint: '/api/admin/workflow-analytics', status: 'workflow-analytics-status', data: 'workflow-analytics-data' },
                { endpoint: '/api/admin/market-intelligence', status: 'market-intelligence-status', data: 'market-intelligence-data' }
            ];

            const results = [];

            for (const test of tests) {
                const success = await testAPI(test.endpoint, test.status, test.data);
                results.push({ endpoint: test.endpoint, success });
                await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between tests
            }

            // Show summary
            const successCount = results.filter(r => r.success).length;
            const summaryElement = document.getElementById('summary');
            const summaryContent = document.getElementById('summary-content');

            summaryContent.innerHTML = `
                <p><strong>Tests Completed:</strong> ${results.length}</p>
                <p><strong>Successful:</strong> ${successCount} âœ…</p>
                <p><strong>Failed:</strong> ${results.length - successCount} âŒ</p>
                <p><strong>Success Rate:</strong> ${Math.round((successCount / results.length) * 100)}%</p>
                <hr>
                <p><strong>Status:</strong> ${successCount === results.length ?
                    'ğŸ‰ ALL SAMPLE DATA IS WORKING! Components can now access rich database content.' :
                    'âš ï¸ Some issues detected. Check individual test results above.'}</p>
            `;

            summaryElement.style.display = 'block';

            console.log('âœ… All tests completed!');
        }

        // Start tests when page loads
        window.addEventListener('load', runAllTests);
    </script>
</body>
</html>